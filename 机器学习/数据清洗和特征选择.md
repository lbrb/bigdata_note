# 数据清洗和特征选择

### 特征工程

- 需要哪些数据
- 数据如何存储
- 数据清洗
- 数据特征工程

##### 需要哪些数据

- 用户行为日志数据：记录用户在系统上所有操作留下来的日志行为数据
- 业务数据：商品、物品的信息、用户、会员的信息
- 第三方数据：爬虫数据、购买的数据，合作方的数据

##### 数据清洗（占机器学习过程的30%~50%左右的时间）

- 预处理

  - 选择处理工具：关系型数据库或者Python
  - 查看数据的元数据以及数据特征：

- 清洗异常样本数据

  - 时间、日期、数值、半全角等格式不一致
  - 内容中有不该存在的字符
  - 内容与该自动应用的内容不符：比如姓名改成了性别、身份证写成了手机号
  - 数据去重、去除替换不合理的值、去除重构不可靠的字段值
  - 数据关联，多个数据源融合

- 采样

  - 数据不平衡

    数据分布的非常不均匀，大多数属于一个类别，另外一个类别只有一部分数据，这种情况下使用机器学习效果可能不大好。

    - 设置损失函数的权重，少量数据将权重调高，使得少数类别数据判断错误的损失大于多数类别数据判断错误的损失。从而导致模型参数往往少数偏
    - 下采样/欠采样：从多数类中随机抽取样本从而减少多数类别样本数据，使数据达到平衡的方式。采用普通的下采样方式会导致信息丢失：
      - EasyEnsemble
      - BalanceCacade
    - Edited Nearest Neighbor(ENN):对于多数类别样本数据而言，如果这个样本的大部分k近邻样本都和自身类别不一样，那我们就将其删除，然后使用删除后的数据训练模型
    - RENN，迭代执行ENN。
    - TOmek Link Removal: 两个样本的最近邻都是对方，将多数类别删除
    - 上采样/过采样，通过抽样的方式增加少数样本的数目
    - SMOTE算法

### 特征转换

- 文本数据转换为数值型数据
  - CountVectorizer
  - TfidfVectorizer
- 缺省值填充（重要但缺失较少）
  - Imputer
- 定性特征属性哑编码(男女，城市)
  - OneHotEncoder
- 定量特征属性二值化（特征取值连续的数据，根据给定的阈值，将其进行转换，如果大于阈值，那么1，否则0）
  - Binarizer
    - 一般情况下，对于不同的特征使用不同的阈值，所以一般我们会拆分为几个DataFrame进行二值化操作，在合并
    - 一搬情况下，对数据划分的时候，不是进行二值化，而是进行多值化（分区化、分桶化），即按照一个连续的数据，按照不同的取值范围，分为不同的级别；比如：在某个模型中，存在人的收入情况。不要对数据做哑编码，因为这里的0,1,2是有关系的
- 特征标准化与归一化
  - StantardScaler标准化：基于特征属性的数据（也就是特征矩阵的列）获取均值和方差，然后将特征值转换至服从标准正态分布。目的是为了降低不同特征的不同范围的取值对于模型训练的影响；梯度
  - MInMaxScaler区间缩放法（归一化）：是指按照数据的取值范围特性对数据进行缩放操作，将数据缩放到给定区间上。目的是为了使得不同维度度量之间特征具有可比性，同时不改变原始数据的分布（相同特性的特征换行后，还是具有相同特性）
  - Normalizer正则化：是基于矩阵的行进行数据处理，其目的是将矩阵的行均转换为单位向量。（通过范式规则来约束特征属性，降低过拟合的可能），不会改变数据的分布情况，但会改变数据特征之间的相关特性
- PolynomialFeatures多项式扩展
  - $ [a, b] [a,b, a^2, b^2]$ 

##### 分词（jieba)

是NLP自然语言处理过程中的基础。

### GBDT + LR 

GBDT可以将数据映射到高纬度空间，这样数据就会分散的很开。这样LR就可以区分不同的类型，做预测

GBDT可以在线下做，LR线上做。

### 特征选择

特征太多，构建模型效率较低，同时模型的效果可能也不大好。这个时候需要从这个特征属性中选择出影响最大的特征作为特征属性建模。

- 方差特别小，可以删除
- 相关性较低，可以删除
- VarianceThreshold(方差选择法)
- SelectKBest(相关系数法)

### PAC

对样本数据X（150， 4）

X-*X = （4,4）

求（4,4）的特征值和特征向量

取最大的两个特征值，将其他的特征值投影到最大的两个特征向量上，这样就只有两个维度了

### 过拟合

将数据分成训练和测试数据集

如果模型在训练集上效果好，在测试集上效果不好，就是过拟合了。

### 过程

特征清洗、特征选择、特征丰富（x1**2)、模型处理

